/*! qajax 0.1.6 - Simple Promise ajax library based on Q */
!function(a){var b;"object"==typeof exports?(b=require("q"),module.exports=a(b)):"function"==typeof define&&define.amd?define(["q"],a):(b=window.Q,window.Qajax=a(b))}(function(a){"use strict";function b(a,b,c){return b=b||{},(void 0===c||null===c)&&(c=f.defaults[a]),a in b?b[a]:c}function c(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]));return c.join("&")}function d(a){return-1===a.indexOf("?")}var e="Content-Type",f=function(){var h,i=arguments;if(!i.length)throw new Error("Qajax: settings are required");if("string"==typeof i[0])h="object"==typeof i[1]&&i[1]||{},h.url=i[0];else{if("object"!=typeof i[0])throw new Error("Qajax: settings must be an object");h=i[0]}if(!h.url)throw new Error("Qajax: settings.url is required");if("xhr"in h&&g("Qajax: xhr parameter is deprecated."),"cancellation"in h&&!a.isPromiseAlike(h.cancellation))throw new Error("cancellation must be a Promise.");var j=h.xhr||new XMLHttpRequest,k=h.cancellation||a.defer().promise,l=b("method",h),m=b("base",h),n=h.url,o=h.data,p=h.params||{},q=a.defer(),r=b("timeout",h,f.TIMEOUT||f.defaults.timeout),s=b("headers",h),t=b("ie",h);t&&(p[t===!0?"_":t]=(new Date).getTime()),m&&(n=m+n);var u=c(p);return u&&(n=n+(d(n)?"?":"&")+u),null!==o&&"object"==typeof o&&(e in s||(s[e]="application/json"),o=JSON.stringify(o)),a.fcall(function(){j.onreadystatechange=function(){if(4===j.readyState)try{g(l+" "+n+" => "+j.status),j.status?q.resolve(j):q.reject(j)}catch(a){q.reject(j)}},j.onprogress=function(a){q.notify(a)},j.open(l,n,!0);for(var a in s)s.hasOwnProperty(a)&&j.setRequestHeader(a,s[a]);return void 0!==o&&null!==o?j.send(o):j.send(),k.fin(function(){q.promise.isFulfilled()||(g("Qajax cancellation reached."),j.abort())}),r?q.promise.timeout(r).fail(function(a){throw a instanceof Error&&(g("Qajax request delay reach in "+l+" "+n),j.abort()),j}):q.promise})};f.TIMEOUT=void 0,f.defaults={logs:!0,timeout:6e4,ie:!0,method:"GET",headers:{},base:""},f.filterStatus=function(b){var c,d;if(d=typeof b,"function"===d)c=b;else{if("number"!==d)throw"validStatus type "+d+" unsupported";c=function(a){return a===b}}return function(b){var d=0;try{d=b.status}catch(e){g("Qajax: failed to read xhr.status")}return 1223===d&&(d=204),c(d)?a.resolve(b):a.reject(b)}},f.filterSuccess=f.filterStatus(function(a){return a>=200&&300>a||304===a}),f.toJSON=function(b){return a.fcall(function(){return JSON.parse(b.responseText)})},f.getJSON=function(a){return f({url:a,method:"GET"}).then(f.filterSuccess).then(f.toJSON)},f.serialize=c;var g=function(a){f.defaults.logs&&window.console&&console.log(a)};return f});